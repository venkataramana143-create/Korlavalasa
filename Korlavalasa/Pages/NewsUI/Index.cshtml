@page
@model Korlavalasa.Pages.NewsUI.IndexModel
@{
    ViewData["Title"] = "Village News";
}

<div class="container-fluid px-3 px-md-4 px-lg-5 mt-4">
    <!-- Header Section -->
    <div class="events-header">
        <div class="container">
            <h1 class="page-title text-center mb-4">
                <i class="fas fa-newspaper me-2"></i>Korlavalasa Village News
            </h1>

            <!-- Stats Bar -->
            <div class="row justify-content-center g-3 mb-4">
                <div class="col-6 col-md-3">
                    <div class="stat-item text-center p-2">
                        <div class="stat-number text-white fw-bold fs-4">@Model.NewsItems.Count</div>
                        <div class="stat-label text-white-50 small">Total News</div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="stat-item text-center p-2">
                        <div class="stat-number text-white fw-bold fs-4">@DateTime.Now.ToString("MMM")</div>
                        <div class="stat-label text-white-50 small">This Month</div>
                    </div>
                </div>
            </div>

            <!-- Add News Button -->
            <div class="text-center">
                <a href="/Admin/AdminNews/Create" class="btn btn-add-event">
                    <i class="fas fa-plus-circle me-2"></i>Add New News (Admin)
                </a>
            </div>
        </div>
    </div>

    <!-- Search and Actions Section -->
    <div class="row justify-content-center mb-5">
        <div class="col-12 col-lg-10 col-xl-8">
            <div class="card search-card border-0 shadow-sm">
                <div class="card-body p-4">
                    <div class="row g-3 align-items-center">
                        <!-- Search Form -->
                        <div class="col-md-8">
                            <form method="get" class="search-form">
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text bg-light border-end-0">
                                        <i class="fas fa-search text-muted"></i>
                                    </span>
                                    <input type="text" class="form-control border-start-0" name="searchString"
                                           value="@Model.SearchString" placeholder="Search news by title or content...">
                                    <button class="btn btn-success px-4" type="submit">
                                        <i class="fas fa-search me-2"></i>Search
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Admin Actions -->
                        <div class="col-md-4 text-md-end">
                            <div class="d-grid d-md-block">
                                <a href="/Admin/AdminNews/Create" class="btn btn-outline-success btn-lg w-100">
                                    <i class="fas fa-plus-circle me-2"></i>Add News
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Search Results Info -->
                    @if (!string.IsNullOrEmpty(Model.SearchString))
                    {
                        <div class="mt-3">
                            <div class="alert alert-info border-0 py-2">
                                <i class="fas fa-info-circle me-2"></i>
                                Showing results for: <strong>"@Model.SearchString"</strong>
                                <a href="/NewsUI" class="btn btn-sm btn-outline-info ms-3">Clear Search</a>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- News List Section -->
    <div class="row justify-content-center">
        <div class="col-12 col-lg-10 col-xl-8">
            @if (Model.NewsItems.Any())
            {
                <div class="news-list">
                    @foreach (var news in Model.NewsItems)
                    {
                        <div class="news-item card border-0 shadow-sm mb-4">
                            <div class="card-body p-0">
                                <div class="row g-0">
                                    <!-- News Image -->
                                    @if (!string.IsNullOrEmpty(news.ImageUrl))
                                    {
                                        <div class="col-md-4">
                                            <div class="news-image-container h-100">
                                                <img src="@news.ImageUrl" alt="@news.Title"
                                                     class="news-image img-fluid h-100 w-100"
                                                     style="object-fit: cover; min-height: 200px;"
                                                     onerror="this.style.display='none'">
                                            </div>
                                        </div>
                                        <div class="col-md-8">
                                            <div class="p-4 h-100 d-flex flex-column">
                                                <!-- News Content -->
                                                <div class="news-content">
                                                    <!-- News Meta -->
                                                    <div class="news-meta d-flex align-items-center mb-3">
                                                        <span class="badge bg-success me-3">
                                                            <i class="fas fa-bullhorn me-1"></i>News
                                                        </span>
                                                        <small class="text-muted">
                                                            <i class="fas fa-calendar-alt me-1"></i>
                                                            <time datetime="@news.PublishedDate.ToString("yyyy-MM-ddTHH:mm:ss")">
                                                                @news.PublishedDate.ToString("MMMM dd, yyyy 'at' hh:mm tt")
                                                            </time>
                                                        </small>
                                                    </div>

                                                    <!-- News Title -->
                                                    <h3 class="news-title fw-bold text-dark mb-3">@news.Title</h3>

                                                    <!-- News Content -->
                                                    <div class="news-body mb-4">
                                                        <p class="card-text text-muted line-clamp-3">@news.Content</p>
                                                    </div>

                                                    <!-- Action Buttons -->
                                                    <div class="news-actions mt-auto">
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <div class="news-status">
                                                                @if (news.IsActive)
                                                                {
                                                                    <span class="badge bg-success">
                                                                        <i class="fas fa-eye me-1"></i>Published
                                                                    </span>
                                                                }
                                                                else
                                                                {
                                                                    <span class="badge bg-secondary">
                                                                        <i class="fas fa-eye-slash me-1"></i>Draft
                                                                    </span>
                                                                }
                                                            </div>
                                                            <div class="action-buttons">
                                                                <a href="/Admin/AdminNews/Edit?id=@news.Id" class="btn btn-sm btn-outline-primary">
                                                                    <i class="fas fa-edit me-1"></i>Edit
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="col-12">
                                            <div class="p-4">
                                                <!-- News Content -->
                                                <div class="news-content">
                                                    <!-- News Meta -->
                                                    <div class="news-meta d-flex align-items-center mb-3">
                                                        <span class="badge bg-success me-3">
                                                            <i class="fas fa-bullhorn me-1"></i>News
                                                        </span>
                                                        <small class="text-muted">
                                                            <i class="fas fa-calendar-alt me-1"></i>
                                                            <time datetime="@news.PublishedDate.ToString("yyyy-MM-ddTHH:mm:ss")">
                                                                @news.PublishedDate.ToString("MMMM dd, yyyy 'at' hh:mm tt")
                                                            </time>
                                                        </small>
                                                    </div>

                                                    <!-- News Title -->
                                                    <h3 class="news-title fw-bold text-dark mb-3">@news.Title</h3>

                                                    <!-- News Content -->
                                                    <div class="news-body mb-4">
                                                        <p class="card-text text-dark line-clamp-3">@news.Content</p>
                                                    </div>

                                                    <!-- Action Buttons -->
                                                    <div class="news-actions mt-auto">
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <div class="news-status">
                                                                @if (news.IsActive)
                                                                {
                                                                    <span class="badge bg-success">
                                                                        <i class="fas fa-eye me-1"></i>Published
                                                                    </span>
                                                                }
                                                                else
                                                                {
                                                                    <span class="badge bg-secondary">
                                                                        <i class="fas fa-eye-slash me-1"></i>Draft
                                                                    </span>
                                                                }
                                                            </div>
                                                            <div class="action-buttons">
                                                                <a href="/Admin/AdminNews/Edit?id=@news.Id" class="btn btn-sm btn-outline-primary">
                                                                    <i class="fas fa-edit me-1"></i>Edit
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>

                <!-- Load More Button (for future pagination) -->
                <div class="text-center mt-5">
                    <button class="btn btn-outline-success btn-lg px-5" id="loadMoreBtn" disabled>
                        <i class="fas fa-sync-alt me-2"></i>Load More News
                    </button>
                    <p class="text-muted mt-2 small">All news articles are currently displayed</p>
                </div>
            }
            else
            {
                <!-- Empty State -->
                <div class="empty-state text-center py-5">
                    <div class="empty-icon mb-4">
                        <i class="fas fa-newspaper fa-4x text-muted opacity-50"></i>
                    </div>
                    <h3 class="text-muted mb-3">No News Available</h3>
                    <p class="text-muted mb-4">There are no news articles to display at the moment.</p>

                    @if (!string.IsNullOrEmpty(Model.SearchString))
                    {
                        <div class="alert alert-warning border-0 mb-4">
                            <i class="fas fa-search me-2"></i>
                            No results found for: <strong>"@Model.SearchString"</strong>
                        </div>
                    }

                    <div class="d-flex flex-column flex-sm-row justify-content-center gap-3">
                        <a href="/NewsUI" class="btn btn-outline-secondary">
                            <i class="fas fa-refresh me-2"></i>View All News
                        </a>
                        <a href="/Admin/AdminNews/Create" class="btn btn-success">
                            <i class="fas fa-plus me-2"></i>Create First News
                        </a>
                    </div>
                </div>
            }
        </div>
    </div>
</div>


@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add loading animation to news items
            const newsItems = document.querySelectorAll('.news-item');
            newsItems.forEach((item, index) => {
                item.style.animationDelay = `${index * 0.1}s`;
            });

            // Search form enhancement
            const searchForm = document.querySelector('.search-form');
            if (searchForm) {
                const searchInput = searchForm.querySelector('input[name="searchString"]');

                searchInput.addEventListener('focus', function() {
                    searchForm.parentElement.classList.add('focused');
                });

                searchInput.addEventListener('blur', function() {
                    searchForm.parentElement.classList.remove('focused');
                });
            }

            // Image error handling
            const newsImages = document.querySelectorAll('.news-image');
            newsImages.forEach(img => {
                img.addEventListener('error', function() {
                    this.style.display = 'none';
                    const parentContainer = this.closest('.col-md-4');
                    if (parentContainer) {
                        parentContainer.classList.remove('col-md-4');
                        parentContainer.classList.add('d-none');
                        const contentCol = parentContainer.nextElementSibling;
                        if (contentCol) {
                            contentCol.classList.remove('col-md-8');
                            contentCol.classList.add('col-12');
                        }
                    }
                });
            });

            // Smooth scroll to top when searching
            if (window.location.search.includes('searchString')) {
                setTimeout(() => {
                    const searchCard = document.querySelector('.search-card');
                    if (searchCard) {
                        window.scrollTo({
                            top: searchCard.offsetTop - 100,
                            behavior: 'smooth'
                        });
                    }
                }, 100);
            }

            // Add intersection observer for animations
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);

            // Observe all news items
            newsItems.forEach(item => {
                item.style.opacity = '0';
                item.style.transform = 'translateY(20px)';
                item.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(item);
            });
        });
    </script>
}